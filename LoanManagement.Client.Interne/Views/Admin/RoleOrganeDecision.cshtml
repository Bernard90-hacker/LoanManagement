@model RoleOrganeDecisionViewModel
@{
	ViewData["Title"] = "Rôle d'un organe de décision";
	var organes = ViewBag.organes as IEnumerable<OrganeDecisionResource>; 
}

@* ************** Content ************** *@

@section VendorStyles {
	<link rel="stylesheet" href="~/vendor/libs/formvalidation/dist/css/formValidation.min.css">
	<link rel="stylesheet" href="~/vendor/libs/flatpickr/flatpickr.dist.css" />
	<link rel="stylesheet" href="~/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.dist.css" />
	<link rel="stylesheet" href="~/vendor/libs/pickr/pickr-themes.dist.css" />
	<link rel="stylesheet" href="~/vendor/libs/animate-css/animate.dist.css" />
	<link rel="stylesheet" href="~/vendor/libs/datatables-bs5/datatables.bootstrap5.dist.css">
	<link rel="stylesheet" href="~/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.dist.css">
	<link rel="stylesheet" href="~/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.dist.css">
	<link rel="stylesheet" href="~/vendor/libs/toastr/toastr.dist.css" />
	<link rel="stylesheet" href="~/vendor/libs/sweetalert2/sweetalert2.dist.css" />
}

@section PageStyles {
	<link rel="stylesheet" href="~/vendor/css/pages/page-auth.dist.css">
}

@section VendorScripts {
	<script src="~/vendor/libs/formvalidation/dist/js/FormValidation.min.js"></script>
	<script src="~/vendor/libs/formvalidation/dist/js/plugins/Bootstrap5.min.js"></script>
	<script src="~/vendor/libs/formvalidation/dist/js/plugins/AutoFocus.min.js"></script>
	<script src="~/vendor/libs/flatpickr/flatpickr.dist.js"></script>
	<script src="~/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.dist.js"></script>
	<script src="~/vendor/libs/pickr/pickr.dist.js"></script>
	<script src="~/vendor/libs/cleavejs/cleave.dist.js"></script>
	<script src="~/vendor/libs/cleavejs/cleave-phone.dist.js"></script>
	<script src="~/vendor/libs/datatables/jquery.dataTables.dist.js"></script>
	<script src="~/vendor/libs/datatables-bs5/datatables-bootstrap5.dist.js"></script>
	<script src="~/vendor/libs/datatables-responsive/datatables.responsive.dist.js"></script>
	<script src="~/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.dist.js"></script>
	<script src="~/vendor/libs/datatables-buttons/datatables-buttons.dist.js"></script>
	<script src="~/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.dist.js"></script>
	<script src="~/vendor/libs/block-ui/block-ui.dist.js"></script>
	<script src="~/vendor/libs/toastr/toastr.dist.js"></script>
	<script src="~/vendor/libs/sweetalert2/sweetalert2.dist.js"></script>
}

@section PageScripts {
	<script>
		$(function () {
			var form = window.$('#form'),
				btn = window.$('#btnSubmit'),
				//indice = $('#indice'),
				//tel = $('#tel'),
				title = '',
				message = '',
				errorTitle = new DOMParser().parseFromString('Erreur', 'text/html').body.innerHTML,
				errorTypeMessage = 'error',
				errorMessage = new DOMParser().parseFromString('Erreur Produite', 'text/html').body.innerHTML,
				errorDescription = '',
				errorTimeOut = 500000,
				errors = [];

			form.on("submit",
				function (event) {
					event.preventDefault();
					var data = window.$(this).serialize();
					var url = window.$(this).attr("action");
					console.log(data);
					window.$.ajax({
						url: url,
						type: "POST",
						dataType: "json",
						data: data,
						beforeSend: function () {
							btn.attr('disabled', 'disabled');
							window.$.blockUI({
								message: '<div class="spinner-border text-primary" role="status"></div>',
								css: {
									backgroundColor: 'transparent',
									border: '0'
								},
								overlayCSS: {
									backgroundColor: '#fff',
									opacity: 0.8
								}
							});
						},
						success: function (response) {
							console.log(response);
							if (response.typeMessage === "error") {
								window.toastr[response.typeMessage]('👋 ' + 'Erreur.',
									{
										showMethod: 'slideDown',
										hideMethod: 'slideUp',
										closeButton: true,
										tapToDismiss: false,
										progressBar: true,
										timeOut: response.timeOut,
										rtl: window.$('html').attr('data-textdirection') === 'rtl',
										onHidden: function () { }
									});
							}
							
							message = new DOMParser().parseFromString(response.message, 'text/html').body.innerHTML;
							window.toastr[response.typeMessage]('👋 ' + message,
								response.title,
								{
									showMethod: 'slideDown',
									hideMethod: 'slideUp',
									closeButton: true,
									tapToDismiss: false,
									progressBar: true,
									timeOut: response.timeOut,
									rtl: window.$('html').attr('data-textdirection') === 'rtl',
									onHidden: function () { }
								});
							
						},
						error: function (response) {
							try {

								var obj = JSON.parse(JSON.stringify(response.responseJSON));
								if (obj.length !== 0) {
									if (response.status === 401) {
										message = new DOMParser().parseFromString('Non autorisé', 'text/html').body.innerHTML;
										window.toastr[errorTypeMessage]('👋 ' + message,
											errorTitle,
											{
												showMethod: 'slideDown',
												hideMethod: 'slideUp',
												closeButton: true,
												tapToDismiss: false,
												progressBar: true,
												timeOut: errorTimeOut,
												rtl: window.$('html').attr('data-textdirection') === 'rtl'
											});
									}
									else {
										if (obj.typeMessage != null && obj.typeMessage !== undefined) {
											if (response.status === 0) {
											} else if (response.status === 400 || response.status === 404 || response.status === 405 || response.status === 500) {
												errorTitle = obj.title;
												errorTypeMessage = obj.typeMessage;
												errorMessage = obj.message;
												errorDescription = obj.description;
												errorTimeOut = obj.timeOut;
												if (obj.erreurs != null && obj.erreurs != undefined) errors = obj.erreurs;
											}
											if (errors !== null && errors !== undefined && errors.length > 0) {
												var messages = '';
												if (errors.length == 1) {
													messages = errors;
												}
												else {
													for (var i = 0; i < errors.length; i++) {
														messages += errors[i] + "<br>";
													}
													messages = messages.slice(0, -4);
												}
												errorMessage = new DOMParser().parseFromString(messages, 'text/html').body.innerHTML;

											} else if (errorDescription !== null && errorDescription !== undefined) {
												errorMessage = new DOMParser().parseFromString(errorDescription, 'text/html').body.innerHTML;
											} else {
												errorMessage = new DOMParser().parseFromString(errorMessage, 'text/html').body.innerHTML;
											}
											window.toastr[errorTypeMessage]('👋 ' + errorMessage,
												errorTitle,
												{
													showMethod: 'slideDown',
													hideMethod: 'slideUp',
													closeButton: true,
													tapToDismiss: false,
													progressBar: true,
													timeOut: errorTimeOut,
													rtl: window.$('html').attr('data-textdirection') === 'rtl'
												}
											);
										}
									}
								}
							} catch (err) {
								window.toastr[errorTypeMessage]('👋 ' + err,
									errorTitle,
									{
										showMethod: 'slideDown',
										hideMethod: 'slideUp',
										closeButton: true,
										tapToDismiss: false,
										progressBar: true,
										timeOut: errorTimeOut,
										rtl: window.$('html').attr('data-textdirection') === 'rtl'
									}
								);
							}
						},
						complete: function () {
							btn.removeAttr('disabled');
							window.$.unblockUI();
						}
					});
				});
		});
	</script>
}
<div class="col-10">
	<div class="card mb-4">
		<h5 class="card-header"></h5>
		<div class="col-sm-7">
			<div class="card-body text-sm-end text-center ps-sm-0">
				<h6 class="mb-b fw-semibold">Organe de décision</h6>
				<form class="card-body" id="form" asp-action="AddRoleOrganeDecision" asp-controller="Admin">
					<div class="row mb-3">
						<label class="col-sm-3 col-form-label text-sm-end">Libellé</label>
						<div class="col-sm-9">
							<input type="text" class="form-control" id="libelle" asp-for="@Model.Resource.Libelle" />
						</div>
					</div>
					<div class="row mb-3">
						<label class="col-sm-3 col-form-label text-sm-end">Organe de décision</label>
						<select id="organeId" class="select2 form-select" data-allow-clear="true" asp-for="@Model.Resource.OrganeDecisionId">
							@if (organes is not null)
							{
								@foreach (var item in organes)
								{
									<option value="@item.Id">@item.Libelle</option>
								}
							}
							else
							{
								<option>Aucun organe enregistré</option>
							}
						</select>
					</div>
					<div class="row mb-3">
						<label class="col-sm-3 col-form-label text-sm-end">Durée de traitement</label>
						<div class="col-sm-9">
							<input type="text" class="form-control" id="duree" asp-for="@Model.Resource.DureeTraitement" />
						</div>
					</div>
					<div class="pt-4">
						<div class="row justify-content-end">
							<div class="col-sm-9">
								<button type="submit" class="btn btn-primary me-sm-2 me-1" id="submit">Envoyer</button>
								<button type="reset" class="btn btn-label-secondary">Annuler</button>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>

	</div>
</div>
